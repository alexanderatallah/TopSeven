<div class="article">
  <div style="position:relative">
    <h3 id="articleTitle">{{title}}</h3>
    <div class="actionButtons" class="clearfix">
      <div class="deleteButton btn btn-lg btn-danger">Delete</div>
      <div class="saveButton btn btn-lg btn-primary">Save</div>
    </div>
  </div>

  <div id="articleHelper" class="alert alert-success alert-dismissable">
    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
    Nice! <strong>Swipe left</strong> on the title to save or delete the article or <strong>swipe right</strong> to go back.
  </div>

  <iframe id="articleFrame" src="{{url}}" width="100%" height="600px"></iframe>
</div>


<script type="text/javascript">
  $(document).ready(function() {
    checkHelper("articleHelper");
    var article = Seven.getArticle(getParam("id"));
    $("#articleTitle").text(article.title);
    $("#articleFrame").attr('src', article.url);

    $(".actionButtons .saveButton").click(function(e) {
      Seven.saveArticle(article);
      window.location = "/";
    });
    $(".actionButtons .deleteButton").click(function(e) {
      Seven.deleteArticle(article);
      window.location = "/";
    });

    articleViewSwiping();
  });

  function articleViewSwiping() {
    var animationDuration = 200;
    var dragCutoff = 100;

    $('#articleTitle').hammer()
      .on("dragleft", function(e) {
        $(this).css({left: e.gesture.deltaX});
      })
      .on("dragend", function(e) {
        if (e.gesture.deltaX < 0) {
          toggleButtons();
        } else if (e.gesture.deltaX > dragCutoff) {
          if (!$(this).data('swiped'))
            window.history.back();
        } else {
          $(this).closest('.article').animate({left: 0}, animationDuration);
        }
      })
      .on("tap", toggleButtons)
      .on("dragright", function(e) {
        if ($(this).data('swiped')) {
          $(this).animate({left: 0}, animationDuration, function() {
            $(this).data('swiped', false);
          });
        } else {
          $(this).closest('.article').css({left: e.gesture.deltaX}); 
        }
      });

    // $('.article-list').hammer().on("tap", ".swipe", function(e) {
    //   window.location = $(e.target).closest('a')[0].href;
    // });
    function toggleButtons(e) {
      if (e) {e.preventDefault(); e.stopPropagation();}

      var $title = $('#articleTitle');
      if ($title.data('swiped')) {
        $title.animate({left: 0}, animationDuration, function() {
          $(this).data('swiped', false);
        });
      } else {
        var target = -1*$('.actionButtons').width();
        $title.animate({left: target}, animationDuration, function() {
          $(this).data('swiped', true);
        });
      }
    }
  }


</script>